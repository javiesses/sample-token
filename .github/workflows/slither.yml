name: Slither Analysis

on:
  push:
    branches: [ master ]
  pull_request:

jobs:
  analyze:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      security-events: write
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Run Custom Action
      uses: javiesses/custom-github-action@v2
      id: custom
      
    - name: Send mail
      uses: dawidd6/action-send-mail@v2
      with:
        server_address: smtp-relay.sendinblue.com
        server_port: 587
        username: ${{secrets.MAIL_SENDER_USERNAME}}
        password: ${{secrets.MAIL_SENDER_PASSWORD}}
        subject: New commit on main branch
        to: ${{secrets.MAIL_TO}}
        from: Your Olympix Assistant <${{secrets.MAIL_SENDER_USERNAME}}>
        body: |
          Hi,
          A new commit has been pushed to the main branch.
          Here is the summary of the contracts analyzed:
          ${{ steps.custom.outputs.lineCounts }}
          Regards,
          Your Olympix Assistant